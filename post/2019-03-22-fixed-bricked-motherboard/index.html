<!DOCTYPE html>

<html lang="ko-kr">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Vasmani&#39;s Blog</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://vasmani.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-1108469-19', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">Vasmani&#39;s Blog</a>
    </div>  
</header>
  <div class="nav-menu">
  
  <a class="color-link nav-link" href="https://vasmani.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    
</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://vasmani.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">벽돌이 된 메인보드 라즈베리파이로 살리기</h1>
    <time>March 22, 2019</time>
    <div>
        <p>
        <p>집에서 쓰는 PC가 너무 노후되어 그나마 덜 노후된 CPU를 어디서 구하게 되어 장착하고자 했다. 근데 BIOS에서 새 CPU를 인식하지 못할 수도 있다라는 글이 있어 먼저 가뿐하게 BIOS를 업데이트 하고 CPU를 교체하려고 했다.</p>
<p>대략 <a href="https://www.intechn.com/DataDetail/152/21">이곳</a>을 참조하여 점퍼스위치를 옮기고 USB에 MS-DOS를 플래시한 후, ROM파일을 넣고, 부팅하여 <code>update.bat</code>를 실행했다.</p>
<p>뭔가 잘 플래시 되는 것 처럼 보이다가 뭔가 경고성 문구가 몇 개 뜨더니 퍽 자동으로 꺼져 버린다. 그리고 나서는 켜지지가 않는다. 켜면 3초 후에 다시 꺼지고, 켜지고를 반복한다. 화면엔 아무 것도 나오지 않는다. 아뿔싸. 한순간에 멍텅구리가 되어 버렸다.</p>
<p>&hellip;</p>
<p>이런 경우는 처음이라 좀 당황했다. 이 메인보드는 검색해도 정보도 별로 안나오는 싸구려 무명 메인보드였다. 역시 사람들이 많이 사용하는 제품을 쓰는게 언제나 옳다.</p>
<figure>
    <img src="/images/0322/Screen%20Shot%202019-03-22%20at%2011.37.18%20AM.png"/> 
</figure>

<p>근데 매뉴얼(해당 제품의 매뉴얼은 제공되지도 않아서 비슷한 제품의 매뉴얼)을 자세히 째려보니</p>
<figure>
    <img src="/images/0322/Screen%20Shot%202019-03-21%20at%201.22.57%20AM.png"/> 
</figure>

<p>왠지 어디선가 본 <code>SPI</code> <code>MOSI</code> <code>MISO</code> <code>CLK</code> 등의 문구가 보인다. 그렇다. 라즈베리파이나 아두이노에서 <code>SPI</code>통신을 했던 것이 기억이 났다. 그렇다면? 복구에 쓰이는 방식이 <code>SPI</code>라는 말인가?</p>
<figure>
    <img src="/images/0322/IMG_0690.JPG"/> 
</figure>

<p><a href="https://www.datasheetq.com/datasheet-download/840460/1/Winbond/25Q64FVSIG">winbond 25Q64FVSIG</a> 라는 IC칩이 있고, 그 옆에 <code>ROM_RECOVERY</code>라고 적혀 있다(사실은 어설프게도 <code>ROM_REGOVERY</code>라고 적혀 있다). 그 옆에 핀들은 매뉴얼의 핀 모양과 같았다.</p>
<p>검색해 보니 라즈베리파이로 이 IC에 플래시 하는 사례가 많이 있었다.</p>
<p>바로 서랍 속에 간직해 둔 오래 된 <code>라즈베리파이 B+</code>을 꺼냈다. 제주에서 <a href="https://github.com/vasmani/space.2-timelapse-scripts">카카오 스페이스닷투 타임랩스</a> 찍을 때도 썼던 레전드!</p>
<p>간만에 <code>raspbian-stretch-lite</code> 이미지를 다운로드 받아 SD카드에 굽고 셋팅을 하였다. <code>flashrom</code>이라는 프로그램을 통해 플래시가 가능했다.</p>
<pre><code>git clone https://github.com/flashrom/flashrom.git
cd flashrom
make &amp;&amp; sudo make install
</code></pre><p>라즈베리파이와 메인보드의 <code>ROM_RECOVERY</code>핀들과 연결 할 차례다. 아래 이미지에서 <code>SPI</code>라고 된 부분들과 3.3V, GND 핀이 사용되었다.</p>
<figure>
    <img src="/images/0322/Screen%20Shot%202019-03-22%20at%2012.32.58%20PM.png"/> 
</figure>

<p><code>SPI</code>에서 사용되는 핀의 종류에는 이름이 좀 혼용되고 있는 것 같다. 예를 들면 <code>MOSI</code>는 <code>DI</code>로 표시되어 있는 곳도 있다. 그래서 아래 표를 참조했다.
<figure>
    <img src="/images/0322/spi-names.PNG"/> 
</figure>
</p>
<table>
<thead>
<tr>
<th>RPi pin#</th>
<th>SPI flash</th>
</tr>
</thead>
<tbody>
<tr>
<td>25</td>
<td>GND</td>
</tr>
<tr>
<td>24</td>
<td>CS (CE0)</td>
</tr>
<tr>
<td>23</td>
<td>SCK (CLK)</td>
</tr>
<tr>
<td>21</td>
<td>DO (MISO)</td>
</tr>
<tr>
<td>19</td>
<td>DI (MOSI)</td>
</tr>
<tr>
<td>17</td>
<td>3.3V</td>
</tr>
</tbody>
</table>
<figure>
    <img src="/images/0322/IMG_0693.JPG"/> 
</figure>

<p>다행히 GPIO 연장선인 <code>Pi Header</code>가 있어서 연결 자체는 어렵지 않았다.</p>
<p>연결후 라즈베리파이를 켜고, ssh를 통해 접속한 후 실제 flash 작업을 해 보았다.</p>
<pre><code>flashrom -p linux_spi:dev=/dev/spidev0.0,spispeed=512 -w NORMAL.ROM
</code></pre>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/02hKkWWayvk" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>한참을 write하다가, verify까지 하더니 완료되었다.</p>
<figure>
    <img src="/images/0322/IMG_0697.JPG"/> 
</figure>

<p>그리고 나서 <code>CMOS</code> 초기화를 위해 메인보드에 붙어 있는 동전 배터리를 탈거했다가 1분 후 다시 넣고, 전원을 넣어 보았다.</p>
<figure>
    <img src="/images/0322/IMG_0698.JPG"/> 
</figure>

<p>오오 시~원하게 잘 된다! 괜한 삽질기 끝!</p>
<h3 id="아주-고마웠던-링크들">아주 고마웠던 링크들</h3>
<ul>
<li><a href="http://www.ktman.pe.kr/RaspberryPi/59648">http://www.ktman.pe.kr/RaspberryPi/59648</a></li>
<li><a href="https://www.flashrom.org/RaspberryPi">https://www.flashrom.org/RaspberryPi</a></li>
<li><a href="https://tomvanveen.eu/flashing-bios-chip-raspberry-pi/">https://tomvanveen.eu/flashing-bios-chip-raspberry-pi/</a></li>
</ul>

        </p>
    </div>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "vasmani-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <div class="page-footer">
        <hr class="footer-divider">
        
        
            <a class="tag" href="/tags/raspberry-pi">#raspberry pi</a>
        
            <a class="tag" href="/tags/bios">#bios</a>
        
            <a class="tag" href="/tags/spi">#SPI</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    

    
    
    

    
</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://vasmani.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>